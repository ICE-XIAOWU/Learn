# 第六章  第一组重构

1. 提炼的关键在于命名。
2. 形成函数并给函数命名，是底层级重构的精髓。

### 1. 提炼函数（Extract Function）

1. 曾用名：提炼函数（Extract Method）；
2. 反向重构： 内联函数（115）；

#### 1.1 动机

1. 提炼函数：浏览其代码，理解其作用，然后将其提炼到一个独立的函数中。
2. 何时把代码放进独立的函数：
   - 意见一：从代码的长度考虑，一个函数应该在一屏展示。
   - 意见二：从复用的角度考虑，只要被用过不止一次的代码，就应该单独放进一个函数中；只因过一次的代码则保持内联的状态。
   - 意见三（最合理的观点-作者角度）：“将意图和实现分开”：如果你需要花时间浏览一段代码才能弄清它到底干什么，那么就应该将其提炼到一个函数中，并根据它所做的事为其命名。
3. 一个好的函数：一眼看到这个函数用途，不用关心其内部是如何实现的，那是函数体干的事。
4. 一个观念：函数名的长度不重要，重要的是能够清楚地表达其用途。
5. 性能优化的指导方针：先编写良好的代码，然后在性能优化的时候才去考虑性能的问题，前面开发的时候先不用担心。
6. 一个情况：一个大函数中，一段代码顶上放着一句注释，说明这段代码要做什么。通常，这个注释往往会提示一个好名字。

#### 1.2 做法

1. 第一步：创建一个新函数，根据其意图来命名（做什么来命名）：
   - 不必过度在意提炼出来的代码不合适，就算最后内联回去了，但只要收获到东西就是值得的。
   - 如果在提炼的过程中无法取得好名字，也许是一个信号，表示该代码不适合提炼，但也有可能在后续的提炼过程中想到好名字。
   - 如果支持嵌套函数的，可以在其源函数内部先提炼，后续再搬移出去。
2. 第二步：将待提炼的代码从源函数复制到新建的目标函数中；
3. 第三步：仔细检查其提炼出的代码，看是否有变量访问不到或者引用了源函数作用域的参数；若是，以参数方式进行传递给新函数：
   - 如果某个变量是在提炼部分之外声明，但只被提炼部分使用，则将其变量一起搬移到提炼部分去。
   - 如果传递给提炼函数的参数过多，则先将其参数进行简化，再进行函数提炼。
4. 第四步：所有变量处理完，编译；
5. 第五步：在源函数中，将被提炼代码替换为对目标代码的调用；
6. 第六步：测试；
7. 第七步：查看其他代码是否有与被提炼的代码段有相似之处，如果有，考虑使用以函数调用取代内联代码令其调用提炼出的新函数。

#### 1.3 范例

- 详见learn-refactoring-book2.0-code仓库。

