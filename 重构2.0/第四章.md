# 第四章 构筑测试体系

### 1. 自测试代码的价值

1. 如果你认真观察大多数程序员如何分配他们的时候，就会发现，他们编写代码的时间仅占所有时间中很少的一部分。有些时间用来决定下一步干什么，有些时间花在设计上，但是，花费在调试上的时间是最多的。
2. 确保所有测试都完全自动化，让它们检查自己的测试结果。
3. 一套测试就是一个强大的bug侦测器，能够大大缩减查找bug所需的时间。
4. 事实上，撰写测试代码的最好时机是在开始动手编码之前。
5. TDD（Test-Driven Development：测试驱动开发）：先编写一个（失败的）测试，编写代码使测试通过，然后进行重构以保证代码的整洁。这是一个循环：测试、编码、重构。

### 2. 待测试的示例代码

1. 一旦业务逻辑的部分开始变复杂，我就会把它与UI分离开，以便能更好地理解和测试它。

### 3. 第一个测试

1. 总是确保测试不该通过时真的会失败。
2. 频繁地运行测试。对于你正在处理的代码，与其对应的测试至少每隔几分钟就要运行一次，每天至少运行一次所有的测试。
3. 只要测试集合中还有失败的测试时，就不应该去重构。

### 4. 在添加一个测试

1. 观察被测试类应该做的所有事情，然后对这个类的每个行为进行测试，包括各种可能使它发生异常的边界条件。
2. 测试应该是一种风险驱动的行为，测试的目标是希望赵处现在或未来可能出现的bug。
3. 编写未臻完善的测试并经常运行，好过对完美测试的无尽等待。

### 6. 探测边界条件

1. 正常路径（happy path）：指的是一切工作正常，用户使用方式也最符合规范的那种场景。
2. 考虑可能出错的边界条件，把测试火力集中在那儿。
3. 测试中的失败：在验证阶段中，实际值与验证语句提供的期待值不想等。
4. 不要因为测试无法捕捉所有的bug就不写测试，因为测试的确可以捕捉到大多数bug。

### 7. 测试远不止如此

1. 每当你遇见一个bug，先写一个测试来清楚地复现它。仅当测试通过时，才视为bug修完。
2. 每当你收到bug报告，请先写一个单元测试来暴露这个bug。